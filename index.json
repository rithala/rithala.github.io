[{"content":" Let\u0026rsquo;s assume you need to summarize the sales data per salesman and prepare a monthly report that will be sent to the manager.\nHow can you do this in Power Automate? The first thing that may come to your mind is to use SharePoint\u0026rsquo;s \u0026ldquo;Get Items\u0026rdquo; action to get all list items for the desired time frame and then calculate the sums yourself in the \u0026ldquo;Apply to each\u0026rdquo; loop. It may work for a small list but it will fail when we get to a larger number of items. Firstly, because of the action maximum items threshold (5000). Secondly, it will take ages to calculate that.\nIn this article, I present the solution that offloads the calculations to the SharePoint API using the \u0026ldquo;renderListDataAsStream\u0026rdquo; method. Instead of calculating the aggregations in a flow, the SharePoint API returns already aggregated data.\nRender List Data As Stream REST Method First of all, let\u0026rsquo;s get to know the tools which we will be using. \u0026ldquo;RednderListDataAsStream\u0026rdquo; is the SharePoint REST API method that allows retrieving list items using a CAML query. This approach is the most flexible way to query SharePoint lists data and is widely used by SharePoint\u0026rsquo;s team to build the SharePoint UI. You can learn more about it in a great article written by my colleague Ewelina. The endpoint is available under the following URL.\n[POST] _api/web/lists/getByTitle(\u0026#39;\u0026lt;list name\u0026gt;\u0026#39;)/RenderListDataAsStream CAML Aggregations If you are familiar with SQL aggregations then CAML aggregations should be pretty straightforward for you. In general, aggregations allow summarizing data as a metric. In CAML you can use one of the following aggregations:\nAggreagation Description COUNT Count list items AVG Average MAX Maximum MIN Minimum SUM Sum STDEV Standard deviation VAR Variance How do you use it in a CAML query? Here is an example of a CAML query summarizing data in the \u0026ldquo;OrderValue\u0026rdquo; field.\n\u0026lt;View\u0026gt; \u0026lt;Aggregations Value=\u0026#34;On\u0026#34;\u0026gt; \u0026lt;FieldRef Name=\u0026#34;OrderValue\u0026#34; Type=\u0026#34;SUM\u0026#34; /\u0026gt; \u0026lt;/Aggregations\u0026gt; \u0026lt;ViewFields\u0026gt; \u0026lt;FieldRef Name=\u0026#34;OrderValue\u0026#34; /\u0026gt; \u0026lt;/ViewFields\u0026gt; \u0026lt;RowLimit\u0026gt;1\u0026lt;/RowLimit\u0026gt; \u0026lt;/View\u0026gt; The query above returns the sum of the order value in all list items (some fields are omitted for brevity).\n{ \u0026#34;Row\u0026#34;: [ { \u0026#34;OrderValue.SUM\u0026#34;: \u0026#34;16,239,943.51 zÅ‚\u0026#34; } ] } Often, you may want to receive the sum for a group. In our case let\u0026rsquo;s assume we want a sum of the order value (OrderValue) column per product category (ProductCategory).\nWhen you are grouping the items it is important to remember how will it behave in a paged response which is the default behavior of this endpoint. You always have to match the \u0026ldquo;GroupLimit\u0026rdquo; attribute of the GroupBy element with the value of the row limit element.\n\u0026lt;View\u0026gt; \u0026lt;Aggregations Value=\u0026#34;On\u0026#34;\u0026gt; \u0026lt;FieldRef Name=\u0026#34;OrderValue\u0026#34; Type=\u0026#34;SUM\u0026#34; /\u0026gt; \u0026lt;/Aggregations\u0026gt; \u0026lt;Query\u0026gt; \u0026lt;GroupBy Collapse=\u0026#34;TRUE\u0026#34; GroupLimit=\u0026#34;20\u0026#34;\u0026gt; \u0026lt;FieldRef Name=\u0026#34;ProductCategory\u0026#34; /\u0026gt; \u0026lt;/GroupBy\u0026gt; \u0026lt;/Query\u0026gt; \u0026lt;ViewFields\u0026gt; \u0026lt;FieldRef Name=\u0026#34;ProductCategory\u0026#34; /\u0026gt; \u0026lt;FieldRef Name=\u0026#34;OrderValue\u0026#34; /\u0026gt; \u0026lt;/ViewFields\u0026gt; \u0026lt;RowLimit Paged=\u0026#34;TRUE\u0026#34;\u0026gt;20\u0026lt;/RowLimit\u0026gt; \u0026lt;/View\u0026gt; Then the response looks like this. The aggregated value is returned in FieldName.AggreagtionFunction.agg.\n{ \u0026#34;Row\u0026#34;: [ { \u0026#34;ProductCategory\u0026#34;: [ { \u0026#34;lookupId\u0026#34;: 1, \u0026#34;lookupValue\u0026#34;: \u0026#34;Beverages\u0026#34; } ], \u0026#34;ProductCategory.singleurlencoded\u0026#34;: \u0026#34;Beverages\u0026#34;, \u0026#34;OrderValue.SUM.agg\u0026#34;: \u0026#34;2,123,446.16 zÅ‚\u0026#34; }, { \u0026#34;ProductCategory\u0026#34;: [ { \u0026#34;lookupId\u0026#34;: 2, \u0026#34;lookupValue\u0026#34;: \u0026#34;Condiments\u0026#34; } ], \u0026#34;ProductCategory.singleurlencoded\u0026#34;: \u0026#34;Condiments\u0026#34;, \u0026#34;OrderValue.SUM.agg\u0026#34;: \u0026#34;1,813,982.89 zÅ‚\u0026#34; }, { \u0026#34;ProductCategory\u0026#34;: [ { \u0026#34;lookupId\u0026#34;: 3, \u0026#34;lookupValue\u0026#34;: \u0026#34;Confections\u0026#34; } ], \u0026#34;ProductCategory.singleurlencoded\u0026#34;: \u0026#34;Confections\u0026#34;, \u0026#34;OrderValue.SUM.agg\u0026#34;: \u0026#34;2,092,854.43 zÅ‚\u0026#34; } ] } How to use it in a Power Automate flow? Now that you know the theory it is time to use it. What was the assumption that the article starts with?\nLet\u0026rsquo;s assume you need to summarize the sales data per salesman and prepare a monthly report that will be sent to the manager.\nSo we start with a blank flow with a schedule trigger that runs every month.\nNext, create variables for a time frame.\nNow is the crucial part, you got to prepare the CAML query. The most convenient way is to use the Compose action. Make your job easier by using single quotes for attribute values. Then you do not need to escape it when sending it in a JSON body.\nIt is time to send the request to the API. Use the \u0026ldquo;Send an HTTP request to SharePoint REST\u0026rdquo; action, set the method parameter to POST and use the described render list data as a stream method for a selected list.\nYou can add the Accept header with application/json;odata.metadata=none value to omit the ODATA metadata in the response.\nAlso, when you use \u0026ldquo;renderListDataAsStream\u0026rdquo; is nice to add the DatesInUtc parameter. Then you are sure that the service account time zone setting does not affect your result.\nThe last task on our list is to send the collected data as a mail report.\nI recommend testing the flow at this stage and copying the JSON response. Then add the Parse JSON action, and use the copied JSON to generate a JSON schema. This will help in working with the action\u0026rsquo;s response in the editor.\nTo make the flow even faster use Select and Create HTML table operations instead of Apply to each to build the report content.\nNow just send the report as an email.\nThat\u0026rsquo;s it! What does the report look like? For sure we can play around with the HTML to make it look better, but should be enough for MVP ðŸ™‚\n","permalink":"https://rithala.github.io/posts/sharepoint-list-items-aggregations-in-power-automate/","summary":"Let\u0026rsquo;s assume you need to summarize the sales data per salesman and prepare a monthly report that will be sent to the manager.\nHow can you do this in Power Automate? The first thing that may come to your mind is to use SharePoint\u0026rsquo;s \u0026ldquo;Get Items\u0026rdquo; action to get all list items for the desired time frame and then calculate the sums yourself in the \u0026ldquo;Apply to each\u0026rdquo; loop. It may work for a small list but it will fail when we get to a larger number of items.","title":"How to aggregate (SUM, AVG, COUNT etc.) SharePoint list items' data efficient in Power Automate"},{"content":"I bet every PowerAutomate consultant wonders if there is an easy way to replace all SharePoint site URLs or variables names in a flow definition ðŸ¤” I could not find the answer, so I built this small (my firstðŸ˜Š) Chrome/Edge extension allowing editing a flow as JSON in a web version of VS Code. Please, share this with your colleagues and feedback is much appreciated ðŸ˜‰\nLink to GitHub\nLink to the Chrome Web Store\n","permalink":"https://rithala.github.io/posts/power-automate-chrome-extension/","summary":"I bet every PowerAutomate consultant wonders if there is an easy way to replace all SharePoint site URLs or variables names in a flow definition ðŸ¤” I could not find the answer, so I built this small (my firstðŸ˜Š) Chrome/Edge extension allowing editing a flow as JSON in a web version of VS Code. Please, share this with your colleagues and feedback is much appreciated ðŸ˜‰\nLink to GitHub\nLink to the Chrome Web Store","title":"Power Automate Chrome Extension"}]